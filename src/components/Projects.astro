---
import Flutter from "../components/icons/Flutter.astro";
import Dart from "../components/icons/Dart.astro";
import Firebase from "../components/icons/Firebase.astro";
import HTML from "../components/icons/HTML.astro";
import CSS from "../components/icons/CSS.astro";
import JavaScript from "../components/icons/JavaScript.astro";
import Python from "../components/icons/Python.astro";
import Django from "../components/icons/Django.astro";
import MySQL from "../components/icons/MySQL.astro";
import Arduino from "../components/icons/Arduino.astro";
import Cpp from "../components/icons/Cpp.astro";
import Docker from "../components/icons/Docker.astro";
import Kubernetes from "../components/icons/Kubernetes.astro";
import GCP from "../components/icons/GCP.astro";

import Project from "./Project.astro";

const TAGS = {
    FLUTTER: {
        name: "Flutter",
        classList: "bg-blue-500 text-white",
        icon: Flutter,
    },
    DART: {
        name: "Dart",
        classList: "bg-blue-500 text-white",
        icon: Dart,
    },
    FIREBASE: {
        name: "Firebase",
        classList: "bg-yellow-800 text-white",
        icon: Firebase,
    },
    HTML: {
        name: "HTML",
        classList: "bg-red-500 text-white",
        icon: HTML,
    },
    CSS: {
        name: "CSS",
        classList: "bg-blue-500 text-white",
        icon: CSS,
    },
    JAVASCRIPT: {
        name: "JavaScript",
        classList: "bg-yellow-800 text-white",
        icon: JavaScript,
    },
    PYTHON: {
        name: "Python",
        classList: "bg-blue-500 text-white",
        icon: Python,
    },
    DJANGO: {
        name: "Django",
        classList: "bg-green-800 text-white",
        icon: Django,
    },
    MYSQL: {
        name: "MySQL",
        classList: "bg-blue-400 text-white ",
        icon: MySQL,
    },
    ARDUINO: {
        name: "Arduino",
        classList: "bg-blue-300 text-white",
        icon: Arduino,
    },
    CPP: {
        name: "C++",
        classList: "bg-blue-500 text-white",
        icon: Cpp,
    },
    DOCKER: {
        name: "Docker",
        classList: "bg-blue-600 text-white",
        icon: Docker,
    },
    KUBERNETES: {
        name: "Kubernetes",
        classList: "bg-blue-700 text-white",
        icon: Kubernetes,
    },
    GCP: {
        name: "GCP",
        classList: "bg-blue-500 text-white",
        icon: GCP,
    },
};

import { translations, type Language } from "../i18n/translations";
import { DEFAULT_LANGUAGE } from "../i18n/utils";

const lang: Language = DEFAULT_LANGUAGE;
const t = translations[lang];

const PROJECTS = [
    {
        title: t.projects.items[0].title,
        description: t.projects.items[0].description,
        image: "/projects/unchaza.webp",
        tags: [TAGS.FLUTTER, TAGS.DART],
        github: "https://github.com/SamuelVar05/Proyecto_IngeSoft",
    },
    {
        title: t.projects.items[1].title,
        description: t.projects.items[1].description,
        image: "/projects/study-buddy.webp",
        tags: [TAGS.FLUTTER, TAGS.DART, TAGS.FIREBASE],
        github: "https://github.com/SamuelVar05/StudyBuddy"
    },
    {
        title: t.projects.items[2].title,
        description: t.projects.items[2].description,
        image: "/projects/evaluacion-docente.webp",
        tags: [
            TAGS.HTML,
            TAGS.CSS,
            TAGS.JAVASCRIPT,
            TAGS.PYTHON,
            TAGS.DJANGO,
            TAGS.MYSQL,
        ],
        github: "https://github.com/SamuelVar05/ProyectoBases"
    },
    {
        title: t.projects.items[3].title,
        description: t.projects.items[3].description,
        image: "/projects/color-picker.webp",
        tags: [TAGS.FLUTTER, TAGS.DART, TAGS.ARDUINO, TAGS.CPP],
        github: "https://github.com/SamuelVar05/color_picker",
    },
    {
        title: t.projects.items[4].title,
        description: t.projects.items[4].description,
        image: "/projects/runpath.webp",
        tags: [TAGS.DOCKER, TAGS.KUBERNETES, TAGS.GCP, TAGS.PYTHON],
        link: "#",
        caseStudy: true,
    },
];

// Get the className and id from the Astro props
const { class: className, id } = Astro.props;
---

<div class=`${className} flex flex-col gap-y-16 md:gap-y-20` id={id}>
    {PROJECTS.map((project, index) => (
        <div class={`project-item-${index}`}>
            <Project project={project} />
        </div>
    ))}
</div>
<script>
	import { translations } from "../i18n/translations";
	
	function getLanguage() {
		if (typeof window === "undefined") return "en";
		const stored = localStorage.getItem("language");
		return stored === "en" || stored === "es" ? stored : "en";
	}
	
	function updateProjectTranslations() {
		const lang = getLanguage();
		const t = translations[lang as keyof typeof translations];
		
		for (let index = 0; index < 5; index++) {
			const container = document.querySelector(`.project-item-${index}`);
			if (!container) continue;
			
			const article = container.querySelector("article");
			const project = t.projects.items[index];
			
			if (article && project) {
				const title = article.querySelector("[data-i18n-project-title]");
				const description = article.querySelector("[data-i18n-project-description]");
				const featured = article.querySelector("[data-i18n-project-featured]");
				const caseStudyBtn = article.querySelector("span[data-i18n-case-study]");
				
				if (title) title.textContent = project.title;
				if (description) description.textContent = project.description;
				if (featured) featured.textContent = t.projects.featured;
				if (caseStudyBtn) caseStudyBtn.textContent = t.projects.caseStudy;
			}
		}
	}
	
	document.addEventListener("DOMContentLoaded", updateProjectTranslations);
	document.addEventListener("astro:page-load", updateProjectTranslations);
	document.addEventListener("languagechange", updateProjectTranslations);
</script>
